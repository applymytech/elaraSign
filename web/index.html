<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>elaraSign - Content Provenance Standard</title>
  <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîê</text></svg>">
  <style>
    /* ============================================
       BASE RESET
    ============================================ */
    * { 
      box-sizing: border-box; 
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
      background: #0a0e1a;
      color: #ffffff;
    }

    /* ============================================
       BACKGROUND: Cover Image + Overlay
    ============================================ */
    .cover-bg {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url('cover.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      z-index: 0;
    }

    .cover-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        135deg,
        rgba(10, 14, 23, 0.92) 0%,
        rgba(19, 24, 33, 0.88) 50%,
        rgba(10, 14, 23, 0.95) 100%
      );
      backdrop-filter: blur(2px);
      z-index: 1;
    }

    /* ============================================
       MAIN CONTAINER
    ============================================ */
    .main-container {
      position: relative;
      z-index: 10;
      max-width: 900px;
      margin: 0 auto;
      padding: 40px 20px;
      min-height: 100vh;
    }

    /* ============================================
       HEADER
    ============================================ */
    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .brand-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
      margin-bottom: 16px;
    }

    .brand-icon {
      font-size: 48px;
      filter: drop-shadow(0 0 20px rgba(0, 212, 255, 0.5));
    }

    .brand-name {
      font-size: 2.5rem;
      margin: 0;
      background: linear-gradient(135deg, #00d4ff 0%, #00d4aa 50%, #a855f7 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
    }

    .tagline {
      font-size: 1.1rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 8px;
    }

    .tagline-emphasis {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.4);
      font-style: italic;
    }

    /* ============================================
       TABS
    ============================================ */
    .tabs {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 24px;
    }

    .tab {
      padding: 12px 32px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.6);
      cursor: pointer;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .tab:hover {
      background: rgba(255, 255, 255, 0.08);
      color: rgba(255, 255, 255, 0.8);
    }

    .tab.active {
      background: rgba(0, 212, 255, 0.15);
      border-color: rgba(0, 212, 255, 0.3);
      color: #00d4ff;
    }

    /* ============================================
       PANEL (Glass Card)
    ============================================ */
    .panel {
      display: none;
      background: rgba(15, 20, 35, 0.85);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      padding: 32px;
    }

    .panel.active { 
      display: block; 
    }

    /* ============================================
       DROP ZONE
    ============================================ */
    .drop-zone {
      border: 2px dashed rgba(255, 255, 255, 0.2);
      border-radius: 16px;
      padding: 60px 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-bottom: 24px;
      background: rgba(255, 255, 255, 0.02);
    }

    .drop-zone:hover, .drop-zone.dragover {
      border-color: #00d4ff;
      background: rgba(0, 212, 255, 0.08);
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.1);
    }

    .drop-zone .icon { 
      font-size: 56px; 
      margin-bottom: 16px;
      filter: drop-shadow(0 0 10px rgba(0, 212, 255, 0.3));
    }

    .drop-zone p { 
      margin: 8px 0; 
      color: rgba(255, 255, 255, 0.6); 
    }

    .drop-zone p strong {
      color: rgba(255, 255, 255, 0.9);
    }

    input[type="file"] { display: none; }

    /* ============================================
       FORM ELEMENTS
    ============================================ */
    .form-group {
      margin-bottom: 16px;
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 500;
    }

    .form-group input, .form-group select {
      width: 100%;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 10px;
      color: #ffffff;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .form-group input:focus, .form-group select:focus {
      outline: none;
      border-color: #00d4ff;
      background: rgba(0, 212, 255, 0.05);
      box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
    }

    .form-group input::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }

    /* Dark-themed Select Dropdown */
    .form-group select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2300d4ff' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 40px;
      cursor: pointer;
    }

    .form-group select option {
      background: #1a1f2e;
      color: #ffffff;
      padding: 12px;
    }

    .form-group select option:hover,
    .form-group select option:checked {
      background: #00d4ff;
      color: #000000;
    }

    /* Dynamic form fields */
    .form-row.hidden {
      display: none;
    }

    .form-group.hidden {
      display: none;
    }

    /* Generation Method Select */
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    @media (max-width: 600px) {
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    /* ============================================
       BUTTONS
    ============================================ */
    button.primary {
      width: 100%;
      padding: 14px 24px;
      background: linear-gradient(135deg, #00d4ff 0%, #00d4aa 100%);
      border: none;
      border-radius: 12px;
      color: #000000;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 8px;
    }

    button.primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 212, 255, 0.3);
    }

    button.primary:disabled {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.3);
      cursor: not-allowed;
      transform: none;
    }

    /* ============================================
       RESULTS
    ============================================ */
    .result {
      margin-top: 24px;
      padding: 24px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 16px;
      display: none;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .result.show { display: block; }

    .result.success { 
      border-color: rgba(0, 212, 170, 0.3);
      background: rgba(0, 212, 170, 0.08);
    }

    .result.error { 
      border-color: rgba(239, 68, 68, 0.3);
      background: rgba(239, 68, 68, 0.08);
    }

    .result.warning { 
      border-color: rgba(245, 158, 11, 0.3);
      background: rgba(245, 158, 11, 0.08);
    }

    .result h3 { 
      margin: 0 0 16px 0;
      font-size: 1.25rem;
    }

    .result p {
      margin: 8px 0;
      color: rgba(255, 255, 255, 0.8);
    }

    .result p strong {
      color: rgba(255, 255, 255, 0.6);
    }

    .result pre {
      background: rgba(0, 0, 0, 0.4);
      padding: 16px;
      border-radius: 10px;
      overflow-x: auto;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.7);
      margin-top: 16px;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* ============================================
       STATUS BADGES
    ============================================ */
    .status-badge {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }

    .status-badge.signed { 
      background: linear-gradient(135deg, #00d4aa 0%, #00b894 100%);
      color: #000; 
    }

    .status-badge.unsigned { 
      background: rgba(239, 68, 68, 0.2);
      border: 1px solid rgba(239, 68, 68, 0.4);
      color: #fca5a5; 
    }

    .status-badge.tampered { 
      background: rgba(245, 158, 11, 0.2);
      border: 1px solid rgba(245, 158, 11, 0.4);
      color: #fcd34d; 
    }

    /* ============================================
       FORENSIC UNLOCK SECTION
    ============================================ */
    .forensic-section {
      margin-top: 20px;
      border: 1px solid rgba(168, 85, 247, 0.3);
      border-radius: 10px;
      overflow: hidden;
      background: rgba(168, 85, 247, 0.05);
    }
    
    .forensic-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      cursor: pointer;
      background: rgba(168, 85, 247, 0.1);
      transition: background 0.2s ease;
    }
    
    .forensic-header:hover {
      background: rgba(168, 85, 247, 0.15);
    }
    
    .forensic-content {
      padding: 16px;
      border-top: 1px solid rgba(168, 85, 247, 0.2);
    }
    
    .forensic-content.hidden {
      display: none;
    }
    
    .forensic-note {
      font-size: 0.85rem;
      color: rgba(255, 255, 255, 0.6);
      margin-bottom: 12px;
    }
    
    .forensic-input-group {
      display: flex;
      gap: 10px;
      margin-bottom: 12px;
    }
    
    .forensic-input-group input {
      flex: 1;
      padding: 10px 14px;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.3);
      color: white;
      font-family: monospace;
      font-size: 0.85rem;
    }
    
    .forensic-input-group input:focus {
      outline: none;
      border-color: #a855f7;
      box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.2);
    }
    
    .forensic-btn {
      padding: 10px 20px;
      background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      white-space: nowrap;
    }
    
    .forensic-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3);
    }
    
    .forensic-success {
      background: rgba(0, 212, 170, 0.1);
      border: 1px solid rgba(0, 212, 170, 0.3);
      border-radius: 8px;
      padding: 16px;
    }
    
    .forensic-success h4 {
      margin: 0 0 12px 0;
      color: #00d4aa;
    }
    
    .forensic-data {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 12px;
    }
    
    .forensic-data p {
      margin: 6px 0;
      font-size: 0.9rem;
    }
    
    .forensic-data code {
      background: rgba(168, 85, 247, 0.2);
      padding: 2px 6px;
      border-radius: 4px;
      font-family: monospace;
      font-size: 0.8rem;
    }
    
    .forensic-error {
      color: #fca5a5;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 6px;
      padding: 10px;
      margin: 0;
    }
    
    .forensic-loading {
      color: #93c5fd;
      margin: 0;
    }

    /* ============================================
       LAYER STATUS (Verification)
    ============================================ */
    .layer-status {
      display: flex;
      gap: 16px;
      margin: 12px 0;
      padding: 10px 14px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-size: 0.9rem;
    }
    
    .layer {
      padding: 4px 10px;
      border-radius: 4px;
    }
    
    .layer.found {
      background: rgba(74, 222, 128, 0.15);
      color: #4ade80;
    }
    
    .layer.missing {
      background: rgba(248, 113, 113, 0.15);
      color: #f87171;
    }

    /* ============================================
       DOWNLOAD BUTTON
    ============================================ */
    .download-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);
      color: white;
      padding: 12px 24px;
      border-radius: 10px;
      text-decoration: none;
      font-weight: 600;
      margin-top: 16px;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .download-btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(168, 85, 247, 0.3);
    }

    .download-note {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 8px;
    }

    /* ============================================
       FOOTER
    ============================================ */
    .footer {
      text-align: center;
      padding: 40px 20px;
      color: rgba(255, 255, 255, 0.4);
      font-size: 0.85rem;
    }

    .footer a {
      color: #00d4ff;
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }

    .footer-tagline {
      margin-top: 8px;
      font-style: italic;
      color: rgba(255, 255, 255, 0.3);
    }

    .footer-links {
      margin-top: 12px;
      display: flex;
      gap: 16px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .footer-links a {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      font-size: 0.8rem;
      transition: all 0.2s ease;
    }

    .footer-links a:hover {
      background: rgba(0, 212, 255, 0.1);
      border-color: rgba(0, 212, 255, 0.3);
      text-decoration: none;
    }

    /* ============================================
       INFO BOX (Transparency Disclosure)
    ============================================ */
    .info-box {
      background: rgba(0, 212, 255, 0.08);
      border: 1px solid rgba(0, 212, 255, 0.2);
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 20px;
      font-size: 0.85rem;
    }

    .info-box.warning {
      background: rgba(255, 193, 7, 0.08);
      border-color: rgba(255, 193, 7, 0.3);
    }

    .info-box h4 {
      color: #00d4ff;
      margin-bottom: 8px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-box.warning h4 {
      color: #ffc107;
    }

    .info-box ul {
      margin: 8px 0 0 0;
      padding-left: 20px;
      color: rgba(255, 255, 255, 0.7);
    }

    .info-box li {
      margin: 4px 0;
    }

    .info-box code {
      background: rgba(255, 255, 255, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    .info-box .expandable {
      cursor: pointer;
      color: rgba(255, 255, 255, 0.5);
      font-size: 0.8rem;
      margin-top: 8px;
    }

    .info-box .expandable:hover {
      color: #00d4ff;
    }

    .info-box .details {
      display: none;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .info-box .details.show {
      display: block;
    }

    /* Build ID Badge */
    .build-badge {
      display: inline-block;
      background: rgba(168, 85, 247, 0.2);
      border: 1px solid rgba(168, 85, 247, 0.3);
      color: #a855f7;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 0.7rem;
      font-family: monospace;
      margin-left: 8px;
    }

    /* Forensic Status Indicator */
    .forensic-status {
      font-size: 0.75rem;
      padding: 4px 12px;
      border-radius: 8px;
      margin-top: 8px;
      display: inline-block;
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid rgba(255, 193, 7, 0.3);
      color: rgba(255, 193, 7, 0.9);
    }

    .forensic-status.enabled {
      background: rgba(0, 212, 170, 0.1);
      border: 1px solid rgba(0, 212, 170, 0.3);
      color: #00d4aa;
    }

    /* ============================================
       RESPONSIVE
    ============================================ */
    @media (max-width: 600px) {
      .main-container {
        padding: 24px 16px;
      }

      .brand-name {
        font-size: 2rem;
      }

      .panel {
        padding: 24px 20px;
        border-radius: 20px;
      }

      .tabs {
        flex-direction: column;
      }

      .tab {
        width: 100%;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- Background: Cover Image + Dark Overlay -->
  <div class="cover-bg"></div>
  <div class="cover-overlay"></div>

  <div class="main-container">
    <!-- Header -->
    <header class="header">
      <div class="brand-header">
        <span class="brand-icon">üîê</span>
        <h1 class="brand-name">elaraSign</h1>
        <span class="build-badge" id="build-id">BUILD</span>
      </div>
      <p class="tagline">Content Provenance Standard</p>
      <p class="tagline-emphasis">"Transparency is not optional"</p>
      <span class="forensic-status" id="forensic-status">‚è≥ Checking forensic status...</span>
    </header>

    <!-- Tabs -->
    <div class="tabs">
      <button class="tab active" onclick="showTab('sign')">‚úçÔ∏è Sign</button>
      <button class="tab" onclick="showTab('verify')">üîç Verify</button>
    </div>

    <!-- Sign Panel -->
    <div id="sign-panel" class="panel active">
      
      <!-- Transparency Disclosure - BRUTALLY HONEST -->
      <div class="info-box warning">
        <h4>‚ö†Ô∏è BRUTAL HONESTY - What This Does &amp; Doesn't Do</h4>
        <p><strong>4 LAYERS OF PROTECTION:</strong></p>
        <ul>
          <li>üè∑Ô∏è <strong>Billboard:</strong> EXIF/metadata visible in Windows Properties</li>
          <li>üß¨ <strong>DNA:</strong> LSB steganography in pixels (lossless only)</li>
          <li>üì° <strong>The Spread:</strong> DCT watermark survives JPEG/screenshots</li>
          <li>üîê <strong>Forensic:</strong> Encrypted accountability (operator only)</li>
        </ul>
        <div class="expandable" onclick="toggleDetails(this)">‚ñ∂ What survives what...</div>
        <div class="details">
          <p><strong style="color: #4ade80;">‚úÖ SURVIVES:</strong></p>
          <ul>
            <li><strong>The Spread (DCT):</strong> JPEG compression, screenshots, cropping, social media upload, format conversion</li>
            <li><strong>DNA (LSB):</strong> Lossless PNG operations, mild cropping</li>
            <li><strong>Billboard (metadata):</strong> Basic file sharing (but easily stripped)</li>
          </ul>
          <p style="margin-top: 12px;"><strong style="color: #f87171;">‚ùå DOES NOT SURVIVE:</strong></p>
          <ul>
            <li>Heavy blur or noise addition</li>
            <li>Extreme compression (&lt;50% JPEG quality)</li>
            <li>Rotation or perspective changes</li>
            <li>AI regeneration (img2img)</li>
            <li>Print and re-scan</li>
            <li>Intentional removal attacks</li>
          </ul>
          <p style="margin-top: 12px;"><strong style="color: #fcd34d;">‚ö†Ô∏è FORENSIC DATA CAPTURED:</strong></p>
          <ul>
            <li>Your IP address at signing time</li>
            <li>Session fingerprint (8-byte hash)</li>
            <li>Unix timestamp (exact second)</li>
            <li>Platform/build ID</li>
          </ul>
          <p style="margin-top: 12px; color: rgba(255, 100, 100, 0.9); font-weight: 600;">
            This data is encrypted and can ONLY be decrypted by the system operator 
            (e.g., upon request from law enforcement). It survives screenshots and JPEG compression.
          </p>
        </div>
      </div>

      <div class="drop-zone" onclick="document.getElementById('sign-file').click()" 
           ondragover="event.preventDefault(); this.classList.add('dragover')"
           ondragleave="this.classList.remove('dragover')"
           ondrop="handleDrop(event, 'sign')">
        <div class="icon">üì§</div>
        <p><strong>Drop file here</strong> or click to browse</p>
        <p>PNG, JPG, WebP, GIF, TIFF, PDF ‚Ä¢ Max 50MB</p>
      </div>
      <input type="file" id="sign-file" accept="image/png,image/jpeg,image/webp,image/gif,image/bmp,image/tiff,application/pdf" onchange="handleFileSelect(this, 'sign')">

      <div class="form-row">
        <div class="form-group">
          <label>Generation Method</label>
          <select id="method" onchange="updateFormFields()">
            <option value="ai">ü§ñ AI Generated</option>
            <option value="human">üé® Human Created</option>
            <option value="mixed">üîÄ Mixed / AI-Assisted</option>
            <option value="unknown">‚ùì Unknown</option>
          </select>
        </div>
        <div class="form-group" id="generator-group">
          <label id="generator-label">Generator / Tool</label>
          <input type="text" id="generator" placeholder="e.g., Midjourney, Photoshop">
        </div>
      </div>

      <!-- AI/Mixed Fields -->
      <div class="form-row" id="ai-fields">
        <div class="form-group">
          <label>Model (optional)</label>
          <input type="text" id="model" placeholder="e.g., FLUX.1, SDXL">
        </div>
        <div class="form-group">
          <label>Prompt (optional)</label>
          <input type="text" id="prompt" placeholder="Generation prompt">
        </div>
      </div>

      <!-- Human/Mixed Creator Fields -->
      <div class="form-row hidden" id="human-fields">
        <div class="form-group">
          <label>Creator Name (optional)</label>
          <input type="text" id="creator-name" placeholder="Your name or handle">
        </div>
        <div class="form-group">
          <label>Contact Email (optional)</label>
          <input type="email" id="creator-email" placeholder="your@email.com">
        </div>
      </div>

      <button class="primary" id="sign-btn" onclick="signFile()" disabled>Sign File</button>

      <div id="sign-result" class="result"></div>
    </div>

    <!-- Verify Panel -->
    <div id="verify-panel" class="panel">
      <div class="drop-zone" onclick="document.getElementById('verify-file').click()"
           ondragover="event.preventDefault(); this.classList.add('dragover')"
           ondragleave="this.classList.remove('dragover')"
           ondrop="handleDrop(event, 'verify')">
        <div class="icon">üîç</div>
        <p><strong>Drop file here</strong> or click to browse</p>
        <p>Check if file has elaraSign provenance</p>
      </div>
      <input type="file" id="verify-file" accept="image/png,image/jpeg,image/webp,image/gif,image/bmp,image/tiff,application/pdf" onchange="handleFileSelect(this, 'verify')">

      <button class="primary" id="verify-btn" onclick="verifyFile()" disabled>Verify File</button>

      <div id="verify-result" class="result"></div>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <p>Part of the <a href="https://openelara.org" target="_blank">OpenElara</a> Universe</p>
      <p class="footer-tagline">"When image APIs adopt this standard, the problem solves itself."</p>
      <div class="footer-links">
        <a href="https://github.com/openelara/elaraSign" target="_blank">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
          GitHub Repo
        </a>
        <a href="https://github.com/openelara/elaraSign/blob/main/docs/README.md" target="_blank">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8l-6-6zm-1 2l5 5h-5V4zM6 20V4h6v6h6v10H6z"/></svg>
          Documentation
        </a>
        <a href="https://github.com/openelara/elaraSign/issues" target="_blank">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
          Report Issue
        </a>
      </div>
    </footer>
  </div>

  <script>
    let signFileData = null;
    let verifyFileData = null;

    const ALLOWED_TYPES = ['image/png', 'image/jpeg', 'image/webp', 'image/gif', 'image/bmp', 'image/tiff', 'application/pdf'];

    // Toggle details in info boxes
    function toggleDetails(el) {
      const details = el.nextElementSibling;
      details.classList.toggle('show');
      el.textContent = details.classList.contains('show') ? '‚ñº Hide details' : '‚ñ∂ More details...';
    }

    // Fetch and display build ID
    async function fetchBuildId() {
      try {
        const res = await fetch('/api/build-info');
        const data = await res.json();
        document.getElementById('build-id').textContent = data.shortId || 'DEV';
        
        // Also check forensic status
        const statusRes = await fetch('/api');
        const statusData = await statusRes.json();
        
        const forensicIndicator = document.getElementById('forensic-status');
        if (forensicIndicator) {
          if (statusData.forensic?.enabled) {
            forensicIndicator.innerHTML = 'üîí Forensic accountability <strong>ENABLED</strong>';
            forensicIndicator.classList.add('enabled');
          } else {
            forensicIndicator.innerHTML = 'üîì Forensic accountability disabled (development mode)';
            forensicIndicator.classList.remove('enabled');
          }
        }
      } catch {
        document.getElementById('build-id').textContent = 'DEV';
      }
    }

    // Dynamic form field management based on generation method
    function updateFormFields() {
      const method = document.getElementById('method').value;
      const aiFields = document.getElementById('ai-fields');
      const humanFields = document.getElementById('human-fields');
      const generatorLabel = document.getElementById('generator-label');
      const generatorInput = document.getElementById('generator');

      // Reset visibility
      aiFields.classList.remove('hidden');
      humanFields.classList.remove('hidden');

      switch (method) {
        case 'ai':
          // AI: Show Generator/Tool + Model/Prompt, hide Human fields
          generatorLabel.textContent = 'Generator / Tool';
          generatorInput.placeholder = 'e.g., Midjourney, DALL-E, Stable Diffusion';
          aiFields.classList.remove('hidden');
          humanFields.classList.add('hidden');
          break;
        case 'human':
          // Human: Show Generator (as Tool) + Name/Email, hide AI fields
          generatorLabel.textContent = 'Tool Used';
          generatorInput.placeholder = 'e.g., Photoshop, Procreate, Camera';
          aiFields.classList.add('hidden');
          humanFields.classList.remove('hidden');
          break;
        case 'mixed':
          // Mixed: Show ALL fields
          generatorLabel.textContent = 'AI Tool / Generator';
          generatorInput.placeholder = 'e.g., Midjourney + Photoshop';
          aiFields.classList.remove('hidden');
          humanFields.classList.remove('hidden');
          break;
        case 'unknown':
          // Unknown: Just basic fields
          generatorLabel.textContent = 'Source (if known)';
          generatorInput.placeholder = 'Where did this come from?';
          aiFields.classList.add('hidden');
          humanFields.classList.add('hidden');
          break;
      }
    }

    // Initialize form fields on load
    document.addEventListener('DOMContentLoaded', () => {
      updateFormFields();
      fetchBuildId();
    });

    // Download both image and sidecar with one click
    function downloadBoth(imageUrl, sidecarUrl) {
      // Download image
      const a1 = document.createElement('a');
      a1.href = imageUrl;
      a1.download = '';
      a1.click();
      
      // Download sidecar (slight delay to ensure both trigger)
      setTimeout(() => {
        const a2 = document.createElement('a');
        a2.href = sidecarUrl;
        a2.download = '';
        a2.click();
      }, 100);
    }

    function showTab(tab) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
      document.querySelector(`.tab:nth-child(${tab === 'sign' ? 1 : 2})`).classList.add('active');
      document.getElementById(`${tab}-panel`).classList.add('active');
    }

    function isValidType(file) {
      return ALLOWED_TYPES.includes(file.type) || file.name.toLowerCase().endsWith('.pdf');
    }

    function handleDrop(e, type) {
      e.preventDefault();
      e.currentTarget.classList.remove('dragover');
      const file = e.dataTransfer.files[0];

      if (file && isValidType(file)) {
        if (type === 'sign') {
          signFileData = file;
          document.getElementById('sign-btn').disabled = false;
        } else {
          verifyFileData = file;
          document.getElementById('verify-btn').disabled = false;
        }
        const icon = file.type === 'application/pdf' ? 'üìÑ' : 'üñºÔ∏è';
        e.currentTarget.innerHTML = `<div class="icon">${icon}</div><p><strong>${file.name}</strong></p><p>${(file.size / 1024).toFixed(1)} KB</p>`;
      } else {
        e.currentTarget.innerHTML = `<div class="icon">‚ùå</div><p><strong>Unsupported format</strong></p><p>Use PNG, JPG, WebP, GIF, TIFF, or PDF</p>`;
      }
    }

    function handleFileSelect(input, type) {
      const file = input.files[0];
      if (file) {
        if (type === 'sign') {
          signFileData = file;
          document.getElementById('sign-btn').disabled = false;
        } else {
          verifyFileData = file;
          document.getElementById('verify-btn').disabled = false;
        }
        const icon = file.type === 'application/pdf' ? 'üìÑ' : 'üñºÔ∏è';
        input.previousElementSibling.innerHTML = `<div class="icon">${icon}</div><p><strong>${file.name}</strong></p><p>${(file.size / 1024).toFixed(1)} KB</p>`;
      }
    }

    async function signFile() {
      if (!signFileData) return;

      const btn = document.getElementById('sign-btn');
      const result = document.getElementById('sign-result');
      btn.disabled = true;
      btn.textContent = 'Signing...';

      const method = document.getElementById('method').value;
      const formData = new FormData();
      formData.append('file', signFileData);
      formData.append('generator', document.getElementById('generator').value || 'elaraSign.web');
      formData.append('method', method);
      
      // AI/Mixed fields
      if (method === 'ai' || method === 'mixed') {
        formData.append('model', document.getElementById('model').value);
        formData.append('prompt', document.getElementById('prompt').value);
      }
      
      // Human/Mixed fields - include creator info
      if (method === 'human' || method === 'mixed') {
        formData.append('creatorName', document.getElementById('creator-name').value);
        formData.append('creatorEmail', document.getElementById('creator-email').value);
      }

      try {
        const res = await fetch('/api/sign', { method: 'POST', body: formData });
        const data = await res.json();

        if (data.success) {
          const isPdf = signFileData.type === 'application/pdf';
          const fileType = isPdf ? 'PDF' : 'Image';
          const methodLabel = {ai: 'ü§ñ AI', human: 'üé® Human', mixed: 'üîÄ Mixed', unknown: '‚ùì Unknown'}[document.getElementById('method').value];
          
          result.className = 'result show success';
          result.innerHTML = `
            <h3>‚úÖ ${fileType} Signed Successfully</h3>
            <p><strong>Generation Method:</strong> ${methodLabel}</p>
            <p><strong>Meta Hash:</strong> ${data.signature.metaHash}</p>
            <p><strong>Locations:</strong> ${data.signature.locations.join(', ')}</p>
            <p><strong>Version:</strong> ${data.signature.version}</p>
            <button class="download-btn" onclick="downloadBoth('${data.downloadUrl}', '${data.sidecarUrl}')">‚¨áÔ∏è Download Signed ${fileType}</button>
            <p class="download-note">Downloads image + sidecar JSON</p>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        } else {
          result.className = 'result show error';
          result.innerHTML = `<h3>‚ùå Signing Failed</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = `<h3>‚ùå Error</h3><p>${err.message}</p>`;
      }

      btn.disabled = false;
      btn.textContent = 'Sign File';
    }

    // Store last verified file for forensic unlock
    let lastVerifiedFile = null;
    let lastMetaHash = null;

    async function verifyFile() {
      if (!verifyFileData) return;

      const btn = document.getElementById('verify-btn');
      const result = document.getElementById('verify-result');
      btn.disabled = true;
      btn.textContent = 'Verifying...';

      const formData = new FormData();
      formData.append('file', verifyFileData);

      try {
        const res = await fetch('/api/verify', { method: 'POST', body: formData });
        const data = await res.json();

        if (data.signed) {
          // Store for forensic unlock
          lastVerifiedFile = verifyFileData;
          lastMetaHash = data.signature?.metaHash;
          
          const statusClass = data.tampered ? 'warning' : 'success';
          const badge = data.tampered
            ? '<span class="status-badge tampered">‚ö†Ô∏è TAMPERED</span>'
            : '<span class="status-badge signed">‚úÖ VERIFIED</span>';
          
          // Build layer status display
          const layers = data.layers || {};
          const layerStatus = `
            <div class="layer-status">
              <span class="layer ${layers.lsb ? 'found' : 'missing'}">üß¨ DNA (LSB): ${layers.lsb ? '‚úì' : '‚úó'}</span>
              <span class="layer ${layers.spreadSpectrum ? 'found' : 'missing'}">üì° Spread: ${layers.spreadSpectrum ? '‚úì ' + (layers.spreadConfidence || 0) + '%' : '‚úó'}</span>
            </div>
          `;

          result.className = `result show ${statusClass}`;
          result.innerHTML = `
            <h3>${badge} elaraSign Provenance Found</h3>
            ${layerStatus}
            <p><strong>Version:</strong> ${data.signature.version}</p>
            <p><strong>Timestamp:</strong> ${data.signature.timestamp || 'N/A'}</p>
            <p><strong>Meta Hash:</strong> <code style="font-size: 0.8em;">${data.signature.metaHash}</code></p>
            <p><strong>Valid Locations:</strong> ${data.signature.validLocations?.join(', ') || 'N/A'}</p>
            <p>${data.message}</p>
            
            <!-- Forensic Unlock Section -->
            <div class="forensic-section">
              <div class="forensic-header" onclick="toggleForensic()">
                <span>üîê Forensic Data (Operator Only)</span>
                <span id="forensic-toggle">‚ñ∂</span>
              </div>
              <div id="forensic-content" class="forensic-content hidden">
                <p class="forensic-note">Enter the master key to reveal accountability data embedded in this image.</p>
                <div class="forensic-input-group">
                  <input type="password" id="forensic-key" placeholder="Enter master key (64 hex characters)" maxlength="64">
                  <button class="forensic-btn" onclick="unlockForensic()">üîì Unlock</button>
                </div>
                <div id="forensic-result"></div>
              </div>
            </div>
            
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        } else {
          lastVerifiedFile = null;
          result.className = 'result show error';
          result.innerHTML = `
            <h3><span class="status-badge unsigned">‚ùå NOT SIGNED</span></h3>
            <p>${data.message}</p>
            <p style="color: rgba(255,255,255,0.5); font-size: 0.9rem; margin-top: 16px;">
              This file has no elaraSign provenance. It could be from any source.
            </p>
          `;
        }
      } catch (err) {
        result.className = 'result show error';
        result.innerHTML = `<h3>‚ùå Error</h3><p>${err.message}</p>`;
      }

      btn.disabled = false;
      btn.textContent = 'Verify File';
    }
    
    function toggleForensic() {
      const content = document.getElementById('forensic-content');
      const toggle = document.getElementById('forensic-toggle');
      content.classList.toggle('hidden');
      toggle.textContent = content.classList.contains('hidden') ? '‚ñ∂' : '‚ñº';
    }
    
    async function unlockForensic() {
      if (!lastVerifiedFile) {
        alert('No verified file available');
        return;
      }
      
      const keyInput = document.getElementById('forensic-key');
      const resultDiv = document.getElementById('forensic-result');
      const key = keyInput.value.trim();
      
      if (!key || key.length !== 64) {
        resultDiv.innerHTML = '<p class="forensic-error">‚ö†Ô∏è Key must be exactly 64 hexadecimal characters</p>';
        return;
      }
      
      resultDiv.innerHTML = '<p class="forensic-loading">üîÑ Decrypting...</p>';
      
      const formData = new FormData();
      formData.append('file', lastVerifiedFile);
      formData.append('key', key);
      
      try {
        const res = await fetch('/api/forensic-unlock', { method: 'POST', body: formData });
        const data = await res.json();
        
        if (data.success) {
          resultDiv.innerHTML = `
            <div class="forensic-success">
              <h4>üîì Forensic Data Decrypted</h4>
              <div class="forensic-data">
                <p><strong>üìÖ Signed At:</strong> ${new Date(data.forensicData.timestamp).toLocaleString()}</p>
                <p><strong>üñ•Ô∏è Platform:</strong> ${data.forensicData.platform}</p>
                <p><strong>üåê IP Address:</strong> ${data.forensicData.ip}</p>
                <p><strong>üîë User Fingerprint:</strong> <code>${data.forensicData.userFingerprint}</code></p>
              </div>
              <p class="forensic-note">This data was encrypted at signing time and is only accessible with the master key.</p>
            </div>
          `;
        } else {
          resultDiv.innerHTML = `<p class="forensic-error">‚ùå ${data.error || 'Decryption failed'}</p>`;
        }
      } catch (err) {
        resultDiv.innerHTML = `<p class="forensic-error">‚ùå Error: ${err.message}</p>`;
      }
    }
  </script>
</body>
</html>
